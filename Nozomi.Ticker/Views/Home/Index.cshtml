@using Nozomi.Service.Identity.Managers
@inject NozomiSignInManager SignInManager
@{
  ViewData["Title"] = "Home Page";
}
<!-- Hero Section -->
<div id="SVGheroBottomShape" class="position-relative gradient-half-primary-v5 z-index-2 overflow-hidden" style="">
      <div class="container space-top-2 space-top-md-5 space-top-lg-4">
        <!-- Title -->
        <div class="w-md-80 w-lg-50 text-center mx-md-auto mb-9">
          <h1 class="display-4 font-size-md-down-5 text-white"><strong class="font-weight-semi-bold">Anything</strong>, polled.</h1>
          <p class="lead text-white-70">Build with Nozomi on your own infrastructure</p>
        </div>
        <!-- End Title -->

        <!-- Slick Carousel -->
        <div class="js-slick-carousel u-slick u-slick--gutters-3 z-index-2"
             data-slides-show="5"
             data-infinite="true"
             data-autoplay="true"
             data-speed="5000"
             data-responsive='[{
               "breakpoint": 1200,
               "settings": {
                 "slidesToShow": 4
               }
             }, {
               "breakpoint": 992,
               "settings": {
                 "slidesToShow": 3
               }
             }, {
               "breakpoint": 768,
               "settings": {
                 "slidesToShow": 2
               }
             }, {
               "breakpoint": 480,
               "settings": {
                 "slidesToShow": 1
               }
             }]'>
          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-primary rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img12.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">Atlassian</h2>
                  <small class="d-block text-secondary">Developer tools</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>

          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-danger rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img13.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">Asana</h2>
                  <small class="d-block text-secondary">Productivity</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>

          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-warning rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img14.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">Slack</h2>
                  <small class="d-block text-secondary">Collaboration tool</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>

          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-success rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img15.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">Spotify</h2>
                  <small class="d-block text-secondary">Streaming service</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>

          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-primary rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img16.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">DigitalOcean</h2>
                  <small class="d-block text-secondary">Cloud infrastructure</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>

          <div class="js-slide mt-1">
            <!-- Icon Block -->
            <article class="card border-0 shadow-sm transition-3d-hover mb-3">
              <div class="card-body bg-primary rounded-top p-5">
                <div class="u-avatar bg-white rounded p-2 mx-auto">
                  <img class="img-fluid" src="../../assets/img/160x160/img16.png" alt="Image Description">
                </div>
              </div>
              <div class="card-body p-4">
                <div class="mb-3">
                  <h2 class="h6 mb-0">DigitalOcean</h2>
                  <small class="d-block text-secondary">Cloud infrastructure</small>
                </div>
                <a class="btn btn-sm btn-block btn-primary" href="#">Install</a>
              </div>
            </article>
            <!-- End Icon Block -->
          </div>
        </div>
        <!-- End Slick Carousel -->
      </div>

      <!-- SVG Bottom Shape -->
      <figure class="position-absolute right-0 bottom-0 left-0">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none" x="0px" y="0px" viewBox="0 0 1921 273" style="margin-bottom: -8px; enable-background:new 0 0 1921 273;" xml:space="preserve" class="injected-svg js-svg-injector" data-parent="#SVGheroBottomShape">
  <style type="text/css">
    .irregular-shape-1-bottom-0{fill:#FFFFFF;}
  </style>
  <polygon class="irregular-shape-1-bottom-0 fill-white" points="0,273 1921,273 1921,0 "></polygon>
</svg>
      </figure>
      <!-- End SVG Bottom Shape -->

      <!-- SVG Background Element -->
      <figure class="position-absolute top-0 right-0 left-0 z-index-n1">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1689.8 974.4" style="enable-background:new 0 0 1689.8 974.4;" xml:space="preserve" class="injected-svg js-svg-injector" data-parent="#SVGheroBottomShape">
<style type="text/css">
	.bg-elements-9-0{fill:none;stroke:#E7EAF3;}
	.bg-elements-9-1{fill:#2679DD;}
</style>
<polygon class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="230.4,18.5 15.8,440.1 313.2,447.2 452.3,265.2 "></polygon>
<polygon class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="15.8,440.1 69.5,726.4 315.9,668.7 313.2,447.2 "></polygon>
<polygon class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="69.5,726.4 51.1,956.7 383.3,962.6 315.9,668.7 "></polygon>
<polygon class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="383.3,962.6 492,785.8 632.5,760.7 713.9,924.9 "></polygon>
<polyline class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="632.5,760.7 778.4,580.9 765.9,351 452.3,265.2 649,95.1 1089.9,48.1 765.9,351 649,95.1 "></polyline>
<polyline class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="1479,151.6 1307.4,403.9 1248.2,644.3 1388.2,760.7 1677.1,616.3 1479,151.6 1089.9,48.1  1307.4,403.9 "></polyline>
<polyline class="bg-elements-9-0 fill-none stroke-gray-300" opacity=".05" stroke-width="3" stroke-miterlimit="10" points="765.9,351 1076.5,671.2 1002.5,829.6 1388.2,760.7 1248.2,644.3 1076.5,671.2 "></polyline>
<circle class="bg-elements-9-1 fill-primary" cx="765.9" cy="351" r="28.8"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="649" cy="95.1" r="18.5"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="452.3" cy="265.2" r="18.5"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="313.2" cy="447.2" r="18.5"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="230.4" cy="18.5" r="18.5"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="15.8" cy="440.1" r="15.8"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="315.9" cy="668.7" r="10"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="69.5" cy="726.4" r="8.6"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="51.1" cy="956.7" r="11.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="383.3" cy="962.6" r="11.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="492" cy="785.8" r="18.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="632.5" cy="760.7" r="12.4"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="713.9" cy="924.9" r="12.4"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="778.4" cy="580.9" r="12.4"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1076.5" cy="671.2" r="15.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1002.5" cy="826.5" r="10.2"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1388.2" cy="760.7" r="17.3"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1248.2" cy="644.3" r="12.8"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1307.4" cy="403.9" r="17.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1479" cy="151.6" r="17.7"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1089.9" cy="48.1" r="12.5"></circle>
<circle class="bg-elements-9-1 fill-primary" cx="1677.1" cy="616.3" r="12.8"></circle>
</svg>
      </figure>
      <!-- End SVG Background Element -->
    </div>
    
     <!-- CTA Section -->
        <div id="vueBody" class="container space-bottom-2 space-bottom-md-3">
          <div class="bg-primary text-white shadow-primary-lg rounded p-5 p-md-9">
            <div class="row justify-content-lg-between align-items-md-center">
              <div class="col">
                <b-table :dark="true"
                  show-empty stacked="md" :busy="currencies.length == 0"
                 :per-page="itemsPerPage" :current-page="currentCurrencyPage"
                 :fields="currencyDataFields" :items="currencies">
          <!-- A virtual composite column -->
          <template slot="name" slot-scope="datum">
            <a :href="'/currency/' + datum.item.abbreviation">{{ datum.item.name }}</a><br>
            {{ datum.item.abbreviation }}
          </template>
          <!-- A virtual composite column -->
          <template slot="marketCap" slot-scope="datum">
            ${{ datum.item.marketCap }}
          </template>
          <!-- A virtual composite column -->
          <template slot="averagePrice" slot-scope="datum">
            ${{ datum.item.averagePrice }}
          </template>
          <!-- A virtual composite column -->
          <template slot="dailyAvgPricePctChange" slot-scope="datum">
            <div class="text-success" v-if="datum.item.dailyAvgPricePctChange > 0">
              {{ datum.item.dailyAvgPricePctChange }}%
              <i class="fas fa-caret-up">
              </i>
            </div>
            <div class="text-success" v-else-if="datum.item.dailyAvgPricePctChange < 0">
              {{ datum.item.dailyAvgPricePctChange }}%
              <i class="fas fa-caret-down">
              </i>
            </div>
            <div v-else>
              {{ datum.item.dailyAvgPricePctChange }}%
            </div>
          </template>
          <template slot="averagePriceHistory" slot-scope="datum">
            <!-- Area Chart -->
            <trend
              :data="datum.item.averagePriceHistory"
              :gradient="['#6fa8dc', '#42b983', '#2c3e50']"
              auto-draw
              smooth
              v-if="datum.item.averagePriceHistory != null && datum.item.averagePriceHistory.length > 0">
            </trend>
          </template>
        </b-table>
        <b-row>
          <b-col md="6" class="my-1">
            <b-pagination :total-rows="currencies.length" :per-page="itemsPerPage"
                          v-model="currentCurrencyPage" class="my-0"/>
          </b-col>
        </b-row>
              </div>
            </div>
          </div>
        </div>
        <!-- End CTA Section -->
  @* <hr class="my-0"> *@
  @* *@
  @* <div class="container space-2 space-md-3"> *@
  @*   <div class="row align-items-lg-center"> *@
  @*     <div class="col-lg-5 mb-7 mb-lg-0"> *@
  @*       <!-- Title --> *@
  @*       <div class="pr-lg-4"> *@
  @*         <span class="btn btn-icon btn-soft-primary rounded-circle mb-3"> *@
  @*           <span class="small font-weight-semi-bold btn-icon__inner">01.</span> *@
  @*         </span> *@
  @*         <h2 class="h4 font-weight-semi-bold text-primary">Cost effective</h2> *@
  @*         <p class="mb-0">Our plans are technically limitless.. You don't have to pay any overcharge because *@
  @*           there isn't one!</p> *@
  @*       </div> *@
  @*       <!-- End Title --> *@
  @*     </div> *@
  @* *@
  @*     <div id="SVGmarketingStrategy" class="col-lg-7 svg-preloader"> *@
  @*       <!-- SVG Icon --> *@
  @*       <figure class="ie-marketing-strategy"> *@
  @*         <img class="js-svg-injector" src="../../assets/svg/illustrations/marketing-strategy.svg" alt="Image Description" *@
  @*              data-parent="#SVGmarketingStrategy"> *@
  @*       </figure> *@
  @*       <!-- End SVG Icon --> *@
  @*     </div> *@
  @*   </div> *@
  @* </div> *@
  @* *@
  @*   <div class="container space-1"> *@
  @*     <div class="row align-items-lg-center"> *@
  @*       <div class="col-lg-5 order-lg-2 mb-7 mb-lg-0"> *@
  @*         <!-- Title --> *@
  @*         <div class="pl-lg-4"> *@
  @*           <span class="btn btn-icon btn-soft-primary rounded-circle mb-3"> *@
  @*             <span class="small font-weight-semi-bold btn-icon__inner">02.</span> *@
  @*           </span> *@
  @*           <h2 class="h4 font-weight-semi-bold text-primary">Safe. Stable. Secure.</h2> *@
  @*           <p class="mb-0">Advanced distributed system architecture built to protect against DDoS and other potential  *@
  @*             threats. Security protocols are fully aligned and compliant with industry best practices.</p> *@
  @*         </div> *@
  @*         <!-- End Title --> *@
  @*       </div> *@
  @* *@
  @*       <div id="SVGappDevelopment" class="col-lg-7 order-lg-1 svg-preloader"> *@
  @*         <!-- SVG Icon --> *@
  @*         <figure class="ie-app-development"> *@
  @*           <img class="js-svg-injector" src="../../assets/svg/illustrations/app-development.svg" alt="SVG Illustration" *@
  @*                data-parent="#SVGappDevelopment"> *@
  @*         </figure> *@
  @*         <!-- End SVG Icon --> *@
  @*       </div> *@
  @*     </div> *@
  @*   </div> *@
  @* *@
  @*   <div class="container space-2 space-md-3"> *@
  @*     <div class="row align-items-lg-center"> *@
  @*       <div class="col-lg-5 mb-7 mb-lg-0"> *@
  @*         <div class="pr-lg-4"> *@
  @*           <span class="btn btn-icon btn-soft-primary rounded-circle mb-3"> *@
  @*             <span class="small font-weight-semi-bold btn-icon__inner">03.</span> *@
  @*           </span> *@
  @*           <h2 class="h4 font-weight-semi-bold text-primary">Analyse the history.</h2> *@
  @*           <p class="mb-0">Nozomi provides a handful of nifty features that will empower you to create powerful *@
  @*             analytical results to help with your business based on the historical data we've obtained.</p> *@
  @*         </div> *@
  @*       </div> *@
  @* *@
  @*       <div id="SVGbusinessAnalysis" class="col-lg-7 svg-preloader"> *@
  @*         <figure class="ie-business-analysis"> *@
  @*           <img class="js-svg-injector" src="../../assets/svg/illustrations/business-analysis.svg" alt="SVG Illustration" *@
  @*                data-parent="#SVGbusinessAnalysis"> *@
  @*         </figure> *@
  @*       </div> *@
  @*     </div> *@
  @*   </div> *@
  
@section Scripts
{
  <script>
    const vm = new Vue({
      // options
      el: "#vueBody",
      // Just dish any random variable in for now
      data: {
        currencyDataFields: [
          {
            key: 'name',
            label: 'Name',
            sortable: true
          },
          {
            key: 'marketCap',
            label: 'Market Cap',
            sortable: true
          },
          {
            key: 'averagePrice',
            label: 'Price',
            sortable: true
          },
          {
            key: 'dailyAvgPricePctChange',
            label: 'Daily Change',
            sortable: true
          },
          {
            key: 'averagePriceHistory',
            label: 'Price Chart',
            sortable: false
          }
        ],
        currentCurrencyPage: 1,
        currencies: [],
        itemsPerPage: 40
      },
      created: function() {
        const connection = new SignalR.HubConnectionBuilder()
          .withUrl("/ticker")
          .build();
            
        // https://github.com/aspnet/SignalR/issues/3294
        connection.start().then(() => {
          connection.invoke("Subscribe", 2).catch(err => console.error(err.toString()));
        }).catch(err => document.write(err));

        function start() {
          try {
            connection.start();
            console.log('connected');
          } catch (err) {
            console.log(err);
            setTimeout(() => start(), 5000);
          }
        };

        connection.onclose(() => {
          start();
        });
        
        connection.on("currencies",
          (currencies) => {
            this.currencies = currencies;
          });
      },
      methods: {
        // This function provides the capability of updating the tickerData array.
        // It does NOT delete deprecated rows. After all, we expect the clients to refresh once a week or so.
//        updateTickerData: function(incomingData) {
//          // Iterate all incoming datum
//          $.each(incomingData, function(incomingDatum) {
//            // Look for the ticker datum in question
//            for (let i = 0; i < this.tickerData.length; i++) {
//              // Found matching ticker
//              if (this.tickerData[i].currencyPairId === incomingDatum.currencyPairId) {
//                // Tell them its updated
//                if (this.tickerData[i].lastUpdated) {
//                  // Bring in data
//                  
//                  
//                  this.tickerData[i].lastUpdated = moment();
//                } else {
//                  // Else we don't have to update... lol
//                }
//                break;
//              }
//            }
//          });
//        }
      },
      mounted: function() {
      }
    });
  </script>
}
