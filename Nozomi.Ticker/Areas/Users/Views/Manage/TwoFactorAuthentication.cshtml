@model Nozomi.Ticker.Areas.Users.Controllers.Manage.TwoFactorAuthentication.TwoFAViewModel

@{
    ViewData["Title"] = "Two-factor authentication (2FA)";
}

<div class="bg-light">
    <div class="container space-2">
        <partial name="Manage/_StatusMessage" for="StatusMessage" />
        <h4>@ViewData["Title"]</h4>
        @if (Model.Is2faEnabled)
        {
            if (Model.RecoveryCodesLeft == 0)
            {
                <div class="alert alert-danger">
                    <strong>You have no recovery codes left.</strong>
                    <p>You must <a asp-action="GenerateRecoveryCode">generate a new set of recovery codes</a> before you can log in with a recovery code.</p>
                </div>
            }
            else if (Model.RecoveryCodesLeft == 1)
            {
                <div class="alert alert-danger">
                    <strong>You have 1 recovery code left.</strong>
                    <p>You can <a asp-action="GenerateRecoveryCode">generate a new set of recovery codes</a>.</p>
                </div>
            }
            else if (Model.RecoveryCodesLeft <= 3)
            {
                <div class="alert alert-warning">
                    <strong>You have @Model.RecoveryCodesLeft recovery codes left.</strong>
                    <p>You should <a asp-action="GenerateRecoveryCode">generate a new set of recovery codes</a>.</p>
                </div>
            }

            if (Model.IsMachineRemembered)
            {
                <form method="post" style="display: inline-block">
                    <button type="submit" class="btn btn-primary">Forget this browser</button>
                </form>
            }
            <form asp-controller="Manage" asp-action="DisableTwoFactorAuthentication" method="post">
                <button type="submit" class="btn btn-primary">Disable 2FA</button>
            </form>
            <a asp-action="GenerateRecoveryCode" class="btn btn-primary">Reset recovery codes</a>
            
            <form asp-controller="Manage" asp-action="DisableTwoFactorAuthentication" method="post">
                <button type="submit" class="btn btn-primary">Reset authenticator app</button>
            </form>
            <form asp-controller="Manage" asp-action="DisableTwoFactorAuthentication" method="post">
                <button type="submit" class="btn btn-danger">Disable two factor authentication</button>
            </form>
        }
        else
        {
            <p>Scan the QR Code or enter this key <kbd>@Model.SharedKey</kbd> into your two factor authenticator app. 
                Spaces and casing do not matter.</p>
            
            <div class="col-sm-4 mb-6">
                <div id="qrCode"></div>
                <div id="qrCodeData" data-url="@Html.Raw(@Model.AuthenticatorUri)"></div>
            </div>
                
                <div class="col-sm-4 mb-6">
                <form asp-controller="Manage" asp-action="TwoFactorAuthentication" method="post">
                    <div class="form-group">
                        <input type="text" asp-for="Code" class="form-control" placeholder="Code"/>
                    </div>
                
                    <button type="submit" class="btn btn-primary">Activate 2FA</button>
                </form>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    @if (!Model.Is2faEnabled) {
        <script src="~/assets/js/qrcode.min.js"></script>
        <script>
            $(document).ready(function() {
                    new QRCode(document.getElementById("qrCode"), "@Model.AuthenticatorUri");
            });
        </script>
    }
}